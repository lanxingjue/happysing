# 小歌星成长记 - Happy Sing!

这是一个基于 PyQt 开发的儿童歌曲学习应用，旨在通过趣味化的教学和正向反馈，帮助孩子建立唱歌的自信。

**当前版本：** Step 2 - 歌曲选择界面

**功能说明：**
*   程序启动后显示一个歌曲列表界面。
*   列表包含几首预设的歌曲名称按钮。
*   点击任意歌曲按钮，会在控制台输出选中的歌曲信息。

**当前版本：** Step 3 - 学习界面框架与界面切换

**功能说明：**
*   程序启动后显示歌曲列表界面。
*   点击歌曲列表中的任一歌曲按钮，界面会切换到学习界面。
*   学习界面显示歌曲标题占位符、歌词占位符、反馈区占位符和控制按钮（暂时不可用）。
*   学习界面包含一个“返回选择歌曲”按钮，点击后可以切换回歌曲选择界面。


**当前版本：** Step 4 - 集成音频播放

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面显示歌曲标题、当前乐句歌词占位符和反馈区占位符。
*   **新增:** “听一听”按钮连接到播放当前乐句对应的音频片段。
*   **注意:** 播放功能需要 `assets/audio/` 目录下存在 `songs.json` 中指定的音频文件（例如 `pawpatrol_full.wav`）。如果文件不存在，会有警告/错误提示，播放功能不可用。

**当前版本：** Step 5 - 集成音频录制 

**功能说明：**
*   引入 PyAudio 库，实现从麦克风录制音频的功能。#
* 将 LearningWidget 中的“我来唱”按钮与录音功能的开始和停止逻辑连接起来。
* 在录音过程中，更新按钮状态和界面提示。
* 录制完成后，保留录制的音频数据以供后续分析（本阶段只保留，不分析）。

**当前版本：** Step 6 - 歌词时序与高亮

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面显示歌曲标题和当前乐句歌词。
*   “听一听”按钮播放当前乐句音频。播放时，对应的歌词会高亮显示。播放结束后，高亮取消。
*   “我来唱”按钮连接到录音功能（已实现开始/停止，但暂无分析和反馈）。录音开始时也会取消高亮。
*   “下一句”按钮切换到下一乐句。


**当前版本：** Step 7 - 基础音频分析（声音能量）与反馈

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面显示歌曲标题和当前乐句歌词。
*   “听一听”按钮播放当前乐句音频。播放时，对应的歌词会高亮显示。播放结束后，高亮取消。
*   “我来唱”按钮连接到录音功能。
*   **新增:** 录音停止后，程序会分析录制音频的音量/能量，并在反馈区显示基于音量大小的积极文字反馈。
*   “下一句”按钮切换到下一乐句。

**当前版本：** Step 8 - 游戏化/反馈系统（角色图片与文字反馈结合）

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面顶部显示歌曲标题和累计星星数（默认为0）。
*   中间显示当前乐句歌词。
*   “听一听”按钮播放当前乐句音频。播放时，对应的歌词会高亮显示。播放结束后，高亮取消。
*   “我来唱”按钮连接到录音功能。
*   录音停止后，程序分析录制音频的音量/能量。
*   **新增:** 根据音量大小，在反馈区显示一个相关的动画片角色图片和一句积极的文字反馈。
*   “下一句”按钮切换到下一乐句。


**当前版本：** Step 9 - 基础音频分析（音高初步判断，使用 librosa）

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面顶部显示歌曲标题和累计星星数。
*   中间显示当前乐句歌词。
*   “听一听”按钮播放当前乐句音频。播放时，对应的歌词会高亮显示。播放结束后，高亮取消。
*   “我来唱”按钮连接到录音功能。
*   录音停止后，程序分析录制音频的音量/能量 **和音高（使用 librosa）**。
*   根据音量大小和是否检测到音高，在反馈区显示更具针对性的角色图片和积极的文字反馈。
*   “下一句”按钮切换到下一乐句。

**当前版本：** Step 10 - 基础音频分析（节奏初步判断，使用 librosa）

**功能说明：**
*   程序启动后从 `data/songs.json` 文件加载歌曲数据。
*   歌曲选择界面显示加载到的已解锁歌曲列表。
*   点击歌曲按钮切换到学习界面。
*   学习界面顶部显示歌曲标题和累计星星数。
*   中间显示当前乐句歌词。
*   “听一听”按钮播放当前乐句音频。播放时，对应的歌词会高亮显示。播放结束后，高亮取消。
*   “我来唱”按钮连接到录音功能。
*   录音停止后，程序分析录制音频的音量/能量、音高 **和节奏（通过检测声音起始点）**。
*   根据这三个分析结果，在反馈区显示更全面、更具针对性的角色图片和积极的文字反馈。
*   “下一句”按钮切换到下一乐句。

**当前版本：** Step 11 - 闯关模式与得分/奖励

**功能说明：**
*   程序启动时从 `data/songs.json` 加载歌曲信息，从 `data/user_progress.json` 加载用户进度。
*   歌曲选择界面根据 `user_progress.json` 中的解锁状态和星星数量显示可玩或锁定的歌曲。
*   点击歌曲按钮切换到学习界面。学习界面顶部显示当前用户的总星星数。
*   学习界面显示歌曲标题、当前乐句歌词。
*   “听一听”按钮播放当前乐句音频并高亮歌词。
*   “我来唱”按钮连接到录音功能。
*   录音停止后，程序分析录制音频的音量、音高、节奏。
*   根据分析结果，在反馈区显示角色图片和文字反馈。
*   **新增:** 根据分析结果的好坏，为当前乐句奖励 0-3 颗星星。
*   **新增:** 获得的星星会累加到用户的总星星数中，并自动保存到 `user_progress.json` 文件。
*   “下一句”按钮切换到下一乐句。
*   **新增:** 完成一首歌曲所有乐句后，程序会触发歌曲完成逻辑，如果用户总星星数达到某些歌曲的解锁条件，会自动解锁新歌曲。
*   返回歌曲选择界面时，歌曲列表会根据最新的用户进度刷新。


**运行要求：**
*   Python 3.6+
*   PyQt6
*   PyAudio
*   NumPy
*   Scipy
*   Librosa
*   资源: `assets/audio/` 中的音频文件，`assets/images/` 中的角色图片。

**运行环境：**
* uv venv --python 3.11
* .venv\Scripts\activate
**安装依赖：**
```bash
pip install -r requirements.txt